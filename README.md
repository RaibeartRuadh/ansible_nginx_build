Пример работы с ansible на примере сборки Nginx из исходного кода с последующим деплоем его на хост и конфигурированием на нестандартный порт.

# Для проверки как это устроено вам потребуется:
- Ubuntu 18-20-22 в качестве рабочего стенда
- Ansible 2.9.6
- Oracle VirtualBox 6.0
- Vagrant 2.2.19

Если по команде vagrant up из основной директории проекта выдает ошибку образа, требуется скачать и установить образ, аналогичный Centos 7 -  https://app.vagrantup.com/centos/boxes/7
Также трубется заменить название образа, которое вы указали при загрузке (команда vagrant box add --name ИМЯ_ОБРАЗА URL or Address to Image) в файле Vagrantfile проекта.

      Vagrant.configure("2") do |config|
         config.vm.box = "ИМЯ_ОБРАЗА"

------------------------------------------------------------

# Установка nginx через сборку из исходников и нестандартным портом

Используя Ansible, мы развернем стенд со следующими условиями:
- Nginx будет собран из исходных модулей кода
- Конфигурационные файлы будут взяты из шаблона jinja2 с переменными
- После установки Nginx, последний должен быть в режиме enabled в systemd
- Будет спользован notify для старта nginx после установки
- Пример сайта будет на порту - 8080

-------------------------------------------------------
# Релизация

Запуск стенда:

		$ bash
		$ vagrant up

Общая концепция плейбука:
- Исходный код выгружаем из удаленного репозитория "http://nginx.org/download/{{ version }}.tar.gz
- При запуске мы задаем ряд параметров для будущего nginx
- Устанавливаем вспомогательные пакеты
- Создаем директорию для страниц сайта
- Устанавливаем репозиторий epel 
- Используя jinja2 шаблон подставляем нашу конфигурацию nginx
- Отдельно заливаем файл index.html
- Notity есть на restart и reload. Прописаны Handlers
- директория под сайт /opt/www

чтобы увидеть страничку выполнить переход по ссылке:

		http://192.168.10.10:8080

---

